


ARM Macro Assembler    Page 1 


    1 00000000         ;
    2 00000000         ; ------------------------------------------------------
                       --------------------------
    3 00000000         ; Start up code for ARM CPU cores
    4 00000000         ; FED1/PER/TIMER/HauLe2
    5 00000000         ; hau.le.eb@rvc.renesas.com
    6 00000000         ;-------------------------------------------------------
                       -------------------------
    7 00000000         ;
    8 00000000 00000000 
                       RAM0_LOWER
                               EQU              0x00000000
    9 00000000 03FFFFFF 
                       RAM0_UPPER
                               EQU              0x03FFFFFF
   10 00000000 04000000 
                       RAM1_LOWER
                               EQU              0x04000000
   11 00000000 07FFFFFF 
                       RAM1_UPPER
                               EQU              0x07FFFFFF
   12 00000000         
   13 00000000 000000FF 
                       FIQ_STACK_SIZE
                               EQU              0xFF
   14 00000000 000000FF 
                       IRQ_STACK_SIZE
                               EQU              0xFF
   15 00000000 000000FF 
                       ABT_STACK_SIZE
                               EQU              0xFF
   16 00000000 000000FF 
                       UND_STACK_SIZE
                               EQU              0xFF
   17 00000000 000000FF 
                       SYS_STACK_SIZE
                               EQU              0xFF
   18 00000000 000000FF 
                       SVC_STACK_SIZE
                               EQU              0xFF
   19 00000000         
   20 00000000 00000010 
                       CPSR_USR_MODE
                               EQU              0x10
   21 00000000 00000011 
                       CPSR_FIQ_MODE
                               EQU              0x11
   22 00000000 00000012 
                       CPSR_IRQ_MODE
                               EQU              0x12
   23 00000000 00000013 
                       CPSR_SVC_MODE
                               EQU              0x13
   24 00000000 00000016 
                       CPSR_MON_MODE
                               EQU              0x16
   25 00000000 00000017 
                       CPSR_ABT_MODE
                               EQU              0x17



ARM Macro Assembler    Page 2 


   26 00000000 0000001A 
                       CPSR_HYP_MODE
                               EQU              0x1A
   27 00000000 0000001B 
                       CPSR_UND_MODE
                               EQU              0x1B
   28 00000000 0000001F 
                       CPSR_SYS_MODE
                               EQU              0x1F
   29 00000000         
   30 00000000         ;-------------------------------------------------------
                       --------------------
   31 00000000         ; Start up code
   32 00000000         ;-------------------------------------------------------
                       --------------------
   33 00000000         
   34 00000000                 AREA             START_UP, CODE, READONLY
   35 00000000                 ENTRY
   36 00000000         
   37 00000000         Vector_Table
   38 00000000 E59FF014        LDR              PC, RST_ADDR
   39 00000004 E59FF014        LDR              PC, UND_ADDR
   40 00000008 E59FF014        LDR              PC, SVC_ADDR
   41 0000000C E59FF014        LDR              PC, PABT_ADDR
   42 00000010 E59FF014        LDR              PC, DABT_ADDR
   43 00000014 E320F000        NOP
   44 00000018 E59FF010        LDR              PC, IRQ_ADDR
   45 0000001C         FIQ_Handler
   46 0000001C         ; FIQ handler code (max size: 4kB)
   47 0000001C         
   48 0000001C 00000000 
                       RST_ADDR
                               DCD              Reset_Handler
   49 00000020 00000000 
                       UND_ADDR
                               DCD              Undef_Handler
   50 00000024 00000000 
                       SVC_ADDR
                               DCD              SVC_Handler
   51 00000028 00000000 
                       PABT_ADDR
                               DCD              P_Abort_Handler
   52 0000002C 00000000 
                       DABT_ADDR
                               DCD              D_Abort_Handler
   53 00000030 00000000 
                       IRQ_ADDR
                               DCD              IRQ_Handler
   54 00000034         
   55 00000034         ;-------------------------------------------------------
                       ------------------------
   56 00000034         ; Reset handler
   57 00000034         ;-------------------------------------------------------
                       ------------------------
   58 00000034         Reset_Handler
   59 00000034         
   60 00000034         ; Initialize unbanked registers
   61 00000034 E3A00000        LDR              R0, = 0
   62 00000038 E3A01000        LDR              R1, = 0



ARM Macro Assembler    Page 3 


   63 0000003C E3A02000        LDR              R2, = 0
   64 00000040 E3A03000        LDR              R3, = 0
   65 00000044 E3A04000        LDR              R4, = 0
   66 00000048 E3A05000        LDR              R5, = 0
   67 0000004C E3A06000        LDR              R6, = 0
   68 00000050 E3A07000        LDR              R7, = 0
   69 00000054         
   70 00000054         ; Initialize banked registers
   71 00000054 E3A08000        LDR              R8, = 0
   72 00000058 E3A09000        LDR              R9, = 0
   73 0000005C E3A0A000        LDR              R10, = 0
   74 00000060 E3A0B000        LDR              R11, = 0
   75 00000064 E3A0C000        LDR              R12, = 0
   76 00000068         
   77 00000068         ;; Enter FIQ mode
   78 00000068         ;; Initialize banked registers in FIQ mode
   79 00000068         ;; Initialize stack pointer in FIQ mode
   80 00000068         ;MSR CPSR_cxsf, #CPSR_FIQ_MODE
   81 00000068         ;LDR R8, = 0
   82 00000068         ;LDR R9, = 0
   83 00000068         ;LDR R10, = 0
   84 00000068         ;LDR R11, = 0
   85 00000068         ;LDR R12, = 0
   86 00000068         ;LDR SP, = RAM1_UPPER - FIQ_STACK_SIZE
   87 00000068         ;
   88 00000068         ;; Enter IRQ mode, disable IRQ interrupt
   89 00000068         ;; Initialize stack pointer in IRQ mode
   90 00000068         ;MSR CPSR_cxsf, #CPSR_IRQ_MODE
   91 00000068         ;LDR SP, = RAM1_UPPER - FIQ_STACK_SIZE - IRQ_STACK_SIZE
   92 00000068         ;
   93 00000068         ;; Enter ABT mode
   94 00000068         ;; Initialize stack pointer in ABT mode
   95 00000068         ;MSR CPSR_cxsf, #CPSR_ABT_MODE
   96 00000068         ;LDR SP, = RAM1_UPPER - FIQ_STACK_SIZE - IRQ_STACK_SIZE 
                       - ABT_STACK_SIZE
   97 00000068         ;
   98 00000068         ;; Enter UND mode
   99 00000068         ;; Initialize stack pointer in UND mode
  100 00000068         ;MSR CPSR_cxsf, #CPSR_UND_MODE
  101 00000068         ;LDR SP, = RAM1_UPPER - FIQ_STACK_SIZE - IRQ_STACK_SIZE 
                       - ABT_STACK_SIZE - UND_STACK_SIZE
  102 00000068         ;
  103 00000068         ;; Enter SVC mode
  104 00000068         ;; Initialize stack pointer in SVC mode
  105 00000068         ;MSR CPSR_cxsf, #CPSR_SVC_MODE
  106 00000068         ;LDR SP, = RAM1_UPPER - FIQ_STACK_SIZE - IRQ_STACK_SIZE 
                       - ABT_STACK_SIZE - UND_STACK_SIZE - SVC_STACK_SIZE
  107 00000068         
  108 00000068         ; Initialize MPU
  109 00000068         ;INCLUDE mpu_init.s
  110 00000068         
  111 00000068         ; Initialize LBSC
  112 00000068         ;INCLUDE lbsc_init.s
  113 00000068         
  114 00000068         ; Jump to main function
  115 00000068 EA000048        B                Main
  116 0000006C         
  117 0000006C E320F000        NOP
  118 00000070 E320F000        NOP



ARM Macro Assembler    Page 4 


  119 00000074 E320F000        NOP
  120 00000078 E320F000        NOP
  121 0000007C E320F000        NOP
  122 00000080 E320F000        NOP
  123 00000084 E320F000        NOP
  124 00000088 E320F000        NOP
  125 0000008C E320F000        NOP
  126 00000090 E320F000        NOP
  127 00000094         
  128 00000094         ;-------------------------------------------------------
                       ------------------------
  129 00000094         ; Undefined instruction handler
  130 00000094         ;-------------------------------------------------------
                       ------------------------
  131 00000094         Undef_Handler
  132 00000094 E320F000        NOP
  133 00000098 E320F000        NOP
  134 0000009C E320F000        NOP
  135 000000A0 E320F000        NOP
  136 000000A4 E320F000        NOP
  137 000000A8 E320F000        NOP
  138 000000AC E320F000        NOP
  139 000000B0 E320F000        NOP
  140 000000B4 E320F000        NOP
  141 000000B8 E320F000        NOP
  142 000000BC E320F000        NOP
  143 000000C0 E12FFF1E        BX               LR
  144 000000C4 E320F000        NOP
  145 000000C8         
  146 000000C8         ;-------------------------------------------------------
                       ------------------------
  147 000000C8         ; Super visor call handler
  148 000000C8         ;-------------------------------------------------------
                       ------------------------
  149 000000C8         SVC_Handler
  150 000000C8 E320F000        NOP
  151 000000CC E320F000        NOP
  152 000000D0 E320F000        NOP
  153 000000D4 E320F000        NOP
  154 000000D8 E320F000        NOP
  155 000000DC E320F000        NOP
  156 000000E0 E320F000        NOP
  157 000000E4 E320F000        NOP
  158 000000E8 E320F000        NOP
  159 000000EC E320F000        NOP
  160 000000F0 E12FFF1E        BX               LR
  161 000000F4 E320F000        NOP
  162 000000F8         
  163 000000F8         ;-------------------------------------------------------
                       ------------------------
  164 000000F8         ; Prefetch abort handler
  165 000000F8         ;-------------------------------------------------------
                       ------------------------
  166 000000F8         P_Abort_Handler
  167 000000F8 E320F000        NOP
  168 000000FC E320F000        NOP
  169 00000100 E320F000        NOP
  170 00000104 E320F000        NOP
  171 00000108 E320F000        NOP



ARM Macro Assembler    Page 5 


  172 0000010C E320F000        NOP
  173 00000110 E320F000        NOP
  174 00000114 E320F000        NOP
  175 00000118 E320F000        NOP
  176 0000011C E320F000        NOP
  177 00000120 E12FFF1E        BX               LR
  178 00000124 E320F000        NOP
  179 00000128         
  180 00000128         ;-------------------------------------------------------
                       ------------------------
  181 00000128         ; Data abort handler
  182 00000128         ;-------------------------------------------------------
                       ------------------------
  183 00000128         D_Abort_Handler
  184 00000128 E320F000        NOP
  185 0000012C E320F000        NOP
  186 00000130 E320F000        NOP
  187 00000134 E320F000        NOP
  188 00000138 E320F000        NOP
  189 0000013C E320F000        NOP
  190 00000140 E320F000        NOP
  191 00000144 E320F000        NOP
  192 00000148 E320F000        NOP
  193 0000014C E320F000        NOP
  194 00000150 E12FFF1E        BX               LR
  195 00000154 E320F000        NOP
  196 00000158         
  197 00000158         ;-------------------------------------------------------
                       ------------------------
  198 00000158         ; Interrupt request handler
  199 00000158         ;-------------------------------------------------------
                       ------------------------
  200 00000158         IRQ_Handler
  201 00000158         
  202 00000158         ; Jump to 0x00005000
  203 00000158 E3A00A05        LDR              R0, = 0x00005000
  204 0000015C E1A0F000        MOV              PC, R0
  205 00000160         
  206 00000160 E320F000        NOP
  207 00000164 E320F000        NOP
  208 00000168 E320F000        NOP
  209 0000016C E320F000        NOP
  210 00000170 E320F000        NOP
  211 00000174 E320F000        NOP
  212 00000178 E320F000        NOP
  213 0000017C E320F000        NOP
  214 00000180 E320F000        NOP
  215 00000184 E320F000        NOP
  216 00000188 E12FFF1E        BX               LR
  217 0000018C E320F000        NOP
  218 00000190         
  219 00000190         ;-------------------------------------------------------
                       ------------------------
  220 00000190         ; Main function
  221 00000190         ;-------------------------------------------------------
                       ------------------------
  222 00000190         Main
  223 00000190         
  224 00000190         ;    ; Copy MAIN by using DMAC



ARM Macro Assembler    Page 6 


  225 00000190         ;    INCLUDE dmac.s
  226 00000190         ;    
  227 00000190         ;    ; Source address
  228 00000190         ;    LDR R0, = DMASAR_16
  229 00000190         ;    LDR R1, = 0x00040000
  230 00000190         ;    STR R1, [R0]
  231 00000190         ;    
  232 00000190         ;    ; Destination address
  233 00000190         ;    LDR R0, = DMADAR_16
  234 00000190         ;    LDR R1, = 0xE6340000
  235 00000190         ;    STR R1, [R0]
  236 00000190         ;    
  237 00000190         ;    ; Transfer count
  238 00000190         ;    LDR R0, = DMATCR_16
  239 00000190         ;    LDR R1, = 0x03EC
  240 00000190         ;    STR R1, [R0]
  241 00000190         ;    
  242 00000190         ;    ; Channel control (transfer size = 0001 = 2 bytes, 
                       source/destination address is increasement, enable DE)
  243 00000190         ;    LDR R0, = DMACHCR_16
  244 00000190         ;    LDR R1, = 0x00005409
  245 00000190         ;    STR R1, [R0]
  246 00000190         ;    
  247 00000190         ;    ; Start to transfer data
  248 00000190         ;    LDR R0, = DMAOR_1
  249 00000190         ;    LDR R1, = 0x0001
  250 00000190         ;    STR R1, [R0]
  251 00000190         ;
  252 00000190         ;    ; Wait until the transfer finish
  253 00000190         ;    LDR R0, = DMACHCR_16
  254 00000190         ;    LDR R2, = 0x00000002
  255 00000190         ;WAIT_TE
  256 00000190         ;    LDR R1, [R0]
  257 00000190         ;    AND R1, R1, R2
  258 00000190         ;    CMP R1, R2
  259 00000190         ;    BNE WAIT_TE
  260 00000190         ;
  261 00000190         ;    NOP
  262 00000190         ;    NOP
  263 00000190         ;    NOP
  264 00000190         ;    NOP
  265 00000190         ;    NOP
  266 00000190         ;    NOP
  267 00000190         ;    NOP
  268 00000190         ;    NOP
  269 00000190         ;    NOP
  270 00000190         ;    NOP
  271 00000190         ;
  272 00000190         ; ; Jump to 0xE6340000
  273 00000190         ; LDR R0, = 0xE6340000
  274 00000190         ; MOV PC, R0
  275 00000190         
  276 00000190         ; Jump to 0x00040000
  277 00000190 E3A00701        LDR              R0, = 0x00040000
  278 00000194 E1A0F000        MOV              PC, R0
  279 00000198         
  280 00000198 E320F000        NOP
  281 0000019C E320F000        NOP
  282 000001A0 E320F000        NOP



ARM Macro Assembler    Page 7 


  283 000001A4 E320F000        NOP
  284 000001A8 E320F000        NOP
  285 000001AC E320F000        NOP
  286 000001B0 E320F000        NOP
  287 000001B4 E320F000        NOP
  288 000001B8 E320F000        NOP
  289 000001BC E320F000        NOP
  290 000001C0 E12FFF1E        BX               LR
  291 000001C4 E320F000        NOP
  292 000001C8         
  293 000001C8                 END
Command Line: --32 --cpu=Cortex-A9 -m --list=startup.list startup.s
